function openEditModalNoticiasAtuais() {
    const editModalNoticiasAtuais = new bootstrap.Modal(document.getElementById('editModalNoticiasAtuais'));
    editModalNoticiasAtuais.show();
}

fetch('../../../html/pages/index/section4.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('my-index-s4-importacao').innerHTML = data;

        function carregarDadosDosCardsNoticias() {
            const cardsData = JSON.parse(localStorage.getItem('noticiasAtuais')) || [];
            const cards = document.querySelectorAll('.my-index-s4-cardAlteracao');

            cards.forEach((card, index) => {
                if (cardsData[index]) {
                    const dataFormatada = formatarDataExibicao(cardsData[index].date);
                    card.querySelector('.my-index-s4-imagem').src = cardsData[index].imageUrl;
                    card.querySelector('.card-title').innerText = cardsData[index].title;
                    card.querySelector('.card-date').innerText = dataFormatada;
                    card.querySelector('.card-time').innerText = cardsData[index].time;
                    card.querySelector('.card-text').innerText = cardsData[index].description;
                    card.querySelector('.my-index-s4-btnVerNoticiasAtuais').setAttribute('onclick', `window.open('${cardsData[index].url}', '_blank')`);
                }
            });
        }

        function formatarDataExibicao(dataISO) {
            const data = new Date(dataISO);
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }

        carregarDadosDosCardsNoticias();

        document.getElementById('saveChangesBtnNoticiasAtuais').addEventListener('click', function () {
            const index = parseInt(document.getElementById('editIndexNoticiasAtuais').value) - 1;
            const cards = document.querySelectorAll('.my-index-s4-cardAlteracao');

            if (index >= 0 && index < cards.length) {
                const selectedCard = cards[index];

                const fileInput = document.getElementById('uploadImageNoticiasAtuais');
                const file = fileInput.files[0];

                const title = document.getElementById('editTitleNoticiasAtuais').value;
                const date = document.getElementById('editDateNoticiasAtuais').value;
                const time = document.getElementById('editTimeNoticiasAtuais').value;
                const description = document.getElementById('editDescriptionNoticiasAtuais').value;
                const url = document.getElementById('editUrlNoticiasAtuais').value;

                if (!file || !title || !date || !time || !description || !url) {
                    alert('Por favor, preencha todos os campos e selecione uma imagem antes de salvar.');
                    return;
                }

                const salvarComImagem = (imageDataUrl) => {
                    const dataFormatada = formatarDataExibicao(date);
                    selectedCard.querySelector('.my-index-s4-imagem').src = imageDataUrl;
                    selectedCard.querySelector('.card-title').innerText = title;
                    selectedCard.querySelector('.card-date').innerText = dataFormatada;
                    selectedCard.querySelector('.card-time').innerText = time;
                    selectedCard.querySelector('.card-text').innerText = description;
                    selectedCard.querySelector('.my-index-s4-btnVerNoticiasAtuais').setAttribute('onclick', `window.open('${url}', '_blank')`);

                    const cardsData = JSON.parse(localStorage.getItem('noticiasAtuais')) || [];
                    cardsData[index] = { imageUrl: imageDataUrl, title, date, time, description, url };
                    localStorage.setItem('noticiasAtuais', JSON.stringify(cardsData));

                    const editModalInstance = bootstrap.Modal.getInstance(document.getElementById('editModalNoticiasAtuais'));
                    if (editModalInstance) {
                        editModalInstance.hide();
                    }

                    alert('Alterações salvas com sucesso!');
                };

                const reader = new FileReader();
                reader.onload = function (e) {
                    salvarComImagem(e.target.result);
                };
                reader.readAsDataURL(file);

            } else {
                alert('Índice inválido. Por favor, escolha um índice de card válido.');
            }
        });
    })
    .catch(error => console.error('Erro ao carregar a página:', error));
